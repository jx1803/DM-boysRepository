<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"      
 "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="org.great.mapper.DrugAllocatMapper">
	
	<!-- ********************************药品剂型************************************ -->
	<!-- 添加药品剂型 -->
	<insert id="addDf" parameterType="org.great.bean.DfBean">
	    insert into tblDf(dosageId,dosageForm)  values(SPMSSEQ.nextval, #{dosageForm,jdbcType=VARCHAR})
	</insert>
	<!-- 查询药品剂型 -->
	<select id="findDf" parameterType="org.great.bean.CondiBean"
		resultType="org.great.bean.DfBean">
		select * from (select ROWNUM rn,d.* from tblDf d where 1=1
		<if test="null!=dosageForm and ''!=dosageForm">
			and d.dosageForm like concat(concat('%',#{dosageForm,jdbcType=VARCHAR}),'%')
		</if>
		 and ROWNUM&lt;=#{pageup,jdbcType=NUMERIC}) where rn&gt;=#{pagedown,jdbcType=NUMERIC}
	</select>
	
	<!-- 查询药品剂型总数 -->
	<select id="findDfCount" parameterType="org.great.bean.CondiBean"
		resultType="java.lang.Integer">
		select count(*) from  tblDf d where 1=1
		<if test="null!=dosageForm and ''!=dosageForm">
			and d.dosageForm like concat(concat('%',#{dosageForm,jdbcType=VARCHAR}),'%')
		</if>
	</select>
	
	<!-- 修改药品剂型名称 -->
	<update id="updDf" parameterType="org.great.bean.DfBean" >
		update tbldf set dosageForm=#{dosageForm} where dosageId=#{dosageId}
	</update>
	
	<!-- 删除药品剂型 -->
	<delete id="delDf" parameterType="org.great.bean.DfBean">
		delete from tblDf where dosageId = #{dosageId}
	</delete>
	
	<!-- ********************************药品类型************************************ -->
	
	<!-- 添加药品类型 -->
	<insert id="addDrugType" parameterType="org.great.bean.DrugTypeBean">
		insert into TBLDRUGTYPE (typeId,pid,drugType) values(SPMSSEQ.nextval,#{pid,jdbcType=NUMERIC},#{drugType,jdbcType=VARCHAR})
	</insert>
	<!--查询药品类型-->
	<select id="findDfDrugType" parameterType="org.great.bean.CondiBean"
		resultType="org.great.bean.DrugTypeBean">
		select * from (select ROWNUM rn,d.*,b.drugType pidName from TBLDRUGTYPE d,TBLDRUGTYPE b where d.pid=b.typeId
		<if test="null!=drugType and ''!=drugType">
			
			and d.drugType like concat(concat('%',#{drugType,jdbcType=VARCHAR}),'%')
		</if>
		and d.pid&gt;0  and ROWNUM&lt;=#{pageup,jdbcType=NUMERIC}) 
		where rn&gt;=#{pagedown,jdbcType=NUMERIC}
	</select>
	<!--查询药品类型总数-->
	<select id="findDtCount" parameterType="org.great.bean.CondiBean"
		resultType="java.lang.Integer">
		select count(*) from TBLDRUGTYPE d where  d.pid&gt;0
		<if test="null!=drugType and ''!=drugType">
			and d.drugType like concat(concat('%',#{drugType,jdbcType=VARCHAR}),'%')
		</if>
	</select>
	<!-- 查询药品一级类型 -->
	<select id="findTopType" parameterType="org.great.bean.DrugTypeBean" resultType="org.great.bean.DrugTypeBean">
		select * FROM TBLDRUGTYPE where pid=#{pid}
	</select> 
	<!-- 删除药品类型 -->
	<delete id="delDrugType" parameterType="org.great.bean.DrugTypeBean">
		delete from TBLDRUGTYPE where typeId=#{typeId}
	</delete>
	<!-- 修改药品类型 -->
	<update id="updDrugType" parameterType="org.great.bean.DrugTypeBean">
		update TBLDRUGTYPE set drugType=#{drugType,jdbcType=VARCHAR},
		pid=#{pid,jdbcType=NUMERIC} where typeId=#{typeId,jdbcType=NUMERIC}
	</update>
	
	<!-- ********************************药品信息************************************ -->
	<!-- 添加药品信息 -->
	<insert id="addDrugInfo" parameterType="org.great.bean.StoDrugBean">
		insert into TBLSTODRUG(drugId,drugName,generalName,specific,unit,retailPrice,dosageId,usage,invoiceTitle,pinyinCode,antibiotic,dosage,dailyNum,typeId,drugmanu,proPlace)
		
		values(DRUGSEQ.nextval,#{drugName,jdbcType=VARCHAR},#{generalName,jdbcType=VARCHAR},#{specific,jdbcType=VARCHAR},#{unit,jdbcType=VARCHAR},#{retailPrice,jdbcType=NUMERIC},
		
		#{dosageId,jdbcType=NUMERIC},#{usage,jdbcType=VARCHAR},#{invoiceTitle,jdbcType=VARCHAR},#{pinyinCode,jdbcType=VARCHAR},#{antibiotic,jdbcType=VARCHAR},#{dosage,jdbcType=VARCHAR},
		
		#{dailyNum,jdbcType=NUMERIC},#{typeId,jdbcType=NUMERIC},#{drugmanu,jdbcType=VARCHAR},#{proPlace,jdbcType=VARCHAR})
	</insert>
	
	
	
<!-- 
 	<select id="documentuser" parameterType="java.lang.String" resultMap="docuMap">
		select b.username,a.* from DOCUMENT a,USERTAB b where a.userid=b.userid 
	</select> 
	<resultMap type="org.xmgreat.bean.DocumentBean" id="docuMap">
		<id property="documentid" column="DOCUMENTID"/>
		<result property="updownload" column="UPDOWNLOAD"/>
		<result property="time" column="TIME"/>
		<result property="documentType" column="DOCUMENTTYPE"/>
		<result property="documentName" column="DOCUMENTNAME"/>
		<result property="documentState" column="DOCUMENTSTATE"/>
		<result property="downpoint" column="DOWNPOINT"/>
		<result property="downtimes" column="DOWNTIMES"/>
		<association property="user" column="USERID" javaType="org.xmgreat.bean.UserBean">
		<id property="userid" column="USERID"/>
		<result property="userName" column="USERNAME"/>
		</association>
	</resultMap>
 -->

</mapper>