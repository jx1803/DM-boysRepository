<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="org.great.mapper.StockWorkMapper">
	<insert id="purchaseApply"
		parameterType="org.great.bean.DrugApplyBean">
		insert into
		tblDrugApply(drugApplyID,adminId,drugId,applyNum,applyDate,checkId,ApplyTypeId,applyReason)
		values(SPMSSEQ.NEXTVAL,#{adminId},#{drugId},#{applyNum},(select
		to_char(sysdate,'yyyy-mm-dd hh24:mi:ss')from
		dual),#{checkId},#{ApplyTypeId},#{applyReason})
	</insert>
	<!-- <update id=""></update> -->

	<!--根据药品编码，药品名称，药品拼音码模糊搜索 -->
	<select id="stoDrugSearch" resultMap="drugMap"
		parameterType="org.great.bean.StoDrugBean">
		select s.*,d.DOSAGEFORM from tblStoDrug s,tblDf d where s.DOSAGEID =
		d.DOSAGEID
		<if test="null != pinyinCode and !''.equals(pinyinCode)">
			and s.pinyinCode like concat(concat('%',#{pinyinCode}),'%')
		</if>
		<if test="null != drugName and !''.equals(drugName)">
			and s.drugName like concat(concat('%',#{drugName}),'%')
		</if>
		<if test="null != drugId and ''!= drugId">
			and and s.drugId like concat(concat('%',#{drugId}),'%')
		</if>
	</select>
	
	<!-- 查找药品返回的结果集 -->
	<resultMap type="org.great.bean.StoDrugBean" id="drugMap">
	   <id property="drugId" column="drugId"/>
	   <result property="drugName" column="drugName"/>
	   <result property="generalName" column="generalName"/>
	   <result property="specific" column="specific"/>
	   <result property="unit" column="unit"/>
	   <result property="retailPrice" column="retailPrice"/>
	   <result property="dosageId" column="dosageId"/>
	   <result property="usage" column="usage"/>
	   <result property="invoiceTitle" column="invoiceTitle"/>
	   <result property="pinyinCode" column="pinyinCode"/>
	   <result property="antibiotic" column="antibiotic"/>
	   <result property="dailyNum" column="dailyNum"/>
	   <result property="typeId" column="typeId"/>
	   <result property="drugmanu" column="drugmanu"/>
	   <result property="proPlace" column="proPlace"/>
	   <association property="dfBean" javaType="org.great.bean.DfBean">
	   	 <id property="dosageId" column="dosageId"/>
	   	 <result property="dosageForm" column="dosageForm"/>
	   </association>
	</resultMap>
</mapper>